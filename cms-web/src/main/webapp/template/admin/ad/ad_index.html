<#include "/admin/_inc/_head.html"/>
<#include "/admin/_inc/_layout.html" />
<!DOCTYPE html>
<html lang="en">

<head>
	<@head />
</head>

<body>
	<@layout>
		<nav class="breadcrumb">
			<!-- 
<i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 产品管理 <span class="c-gray en">&gt;</span> 品牌管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a>
 -->
		</nav>
		<div class="pd-20">
			<div class="text-l">
				<!-- <form id="query_form">
			<input type="text" class="input-text" style="width:250px" placeholder="输入名称" id="" name="title">
			<button type="button" class="btn btn-success" id="btn_query" ><i class="Hui-iconfont">&#xe665;</i> 查询</button>
		</form> -->
			</div>

			<div class="cl pd-5 bg-1 bk-gray mt-20">
				<span class="l">
					<a href="javascript:;" onclick="tgridObj.add();" class="btn btn-primary radius">
						<i class="Hui-iconfont">&#xe600;</i> 添加</a>
					<a href="javascript:;" onclick="tgridObj.edit();" class="btn btn-primary radius">
						<i class="Hui-iconfont">&#xe60c;</i> 编辑</a>
					<a href="javascript:;" onclick="tgridObj.del();" class="btn btn-danger radius">
						<i class="Hui-iconfont">&#xe605;</i>删除</a>
				</span>
				<span class="r">共有数据：
					<strong class="total">0</strong> 条</span>
			</div>

			<table id="datatable"></table>
			<div id="pagination" class="cl pd-10 r"></div>

		</div>

	</@layout>

	<@tablejs />

	<script type="text/javascript">
		$(function () {

			$('#btn_query').click(function (e) {
				var params = {};
				params = $('#query_form').serializeJSON();

				$('#datatable').tgrid('load', params);
			})
			tgridObj.init();

		});


		var tgridObj = {
			init: function () {
				$('#datatable').tgrid({
					columns: tgridObj.columns,
					checkbox: true,
					url: global.adminPath + '/ad/datapage'
				});
			},
			load: function () {
				var params = {};
				params = $('#query_form').serializeJSON();
				$('#datatable').tgrid('load', params);
			},
			columns: [{
				width: '60',
				align: 'center',
				title: '名称',
				field: 'adName'
			}, {
				width: '60',
				title: '图片',
				align: 'center',
				field: 'adCode',
				formatter: function (value, row, index) {
					return '<img style="width: 180px;height: 60px;" src="' + value + '">';
				}
			}, {
				width: '60',
				title: '开始时间',
				align: 'center',
				field: 'startTime',
				formatter: function (value, row, index) {
					return new Date(value).format("yyyy-MM-dd");

				}
			}, {
				width: '60',
				align: 'center',
				title: '结束时间',
				field: 'endTime',
				formatter: function (value, row, index) {
					return new Date(value).format("yyyy-MM-dd");

				}
			}, {
				width: '60',
				align: 'center',
				title: '是否显示',
				field: 'enabled',
				formatter: function (value, row, index) {
					if (value) {
						return '显示';
					} else {
						return '隐藏';
					}
				}
			}],
			add: function () {
				var url = global.adminPath + '/ad/addview';
				layer_show('添加', url, 800, 500);
			},
			edit: function () {
				var obj = $('#datatable').tgrid('getSelections');

				if (obj.length != 1) {
					layer.alert('请选择一条', {
						icon: 7
					});
					return false;
				}

				var url = global.adminPath + '/ad/edit/' + obj[0].id;
				layer_show('编辑', url, 800, 500);
			},
			del: function () {

				var obj = $('#datatable').tgrid('getSelections');

				if (obj.length != 1) {
					layer.alert('请选择一条', {
						icon: 7
					});
					return false;
				}

				layer.confirm('确认要删除吗？', function (index) {
					var data = {};

					$.ajax({
						type: "POST",
						data: data,
						dataType: 'json',
						url: global.adminPath + '/ad/delete/' + obj[0].id,
						success: function (res) {
							if (res.success) {
								tgridObj.load();
								layer.alert('已删除!', {
									icon: 1
								});
							} else {
								layer.alert(res.message, {
									icon: 2
								});
							}
						}
					});


				});
			}

		}



	</script>
</body>

</html>